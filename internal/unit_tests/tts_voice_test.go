package unittests

import (
	"context"
	"log"
	"testing"
	"time"

	"rio-go-model/configs"
	"rio-go-model/internal/services"
	"rio-go-model/internal/services/database"
	"rio-go-model/internal/util"
)

var testStoryDB *database.StoryDatabase
var testDBInitialized bool

func init() {
	ctx, cancel := context.WithTimeout(context.Background(), 60*time.Second)
	defer cancel()

	log.Println("üîß Initializing services at startup...")

	// Initialize global settings first
	configs.InitializeSettings()

	// Create and initialize AppService
	config := configs.LoadConfig()
	appService := services.NewAppService(config)

	// Initialize all services (Firestore, Storage, etc.)
	if err := appService.Initialize(ctx); err != nil {
		log.Printf("‚ö†Ô∏è  AppService initialization failed (credentials may be missing): %v", err)
		log.Printf("‚ÑπÔ∏è  Tests requiring database will be skipped")
		testStoryDB = nil
		testDBInitialized = false
		return
	}

	// Set the singleton instance
	services.SetInstance(appService)
	log.Println("‚úÖ AppService singleton initialized successfully")

	// Get database instance from AppService
	testStoryDB = appService.GetFirestore()
	testDBInitialized = testStoryDB != nil
}

// TestGetVoiceList_Voices tests the GetVoiceList function
func TestGetVoiceList_Voices(t *testing.T) {
	tests := []struct {
		name     string
		voice    string
		wantNil  bool // true if we expect nil result
		minCount int  // minimum expected voices (if not nil)
	}{
		{
			name:     "Standard voice",
			voice:    "Standard",
			wantNil:  false,
			minCount: 1,
		},
		{
			name:     "Chirp3HD voice",
			voice:    "Chirp3HD",
			wantNil:  false,
			minCount: 1,
		},
		{
			name:     "Invalid voice",
			voice:    "InvalidVoice",
			wantNil:  true,
			minCount: 0,
		},
	}

	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			voiceList := util.GetVoiceList(tt.voice)

			if tt.wantNil {
				if voiceList != nil {
					t.Errorf("GetVoiceList(%q) = %v, want nil", tt.voice, voiceList)
				}
			} else {
				if voiceList == nil {
					t.Errorf("GetVoiceList(%q) = nil, want non-nil", tt.voice)
				} else if len(voiceList) < tt.minCount {
					t.Errorf("GetVoiceList(%q) returned %d voices, want at least %d", tt.voice, len(voiceList), tt.minCount)
				}
			}
		})
	}
}

// TestSuspendAudioAPI_Database tests the SuspendAudioAPI function
// Note: This requires a valid database connection and API trigger data
// This test will be skipped if database credentials are not available
func TestSuspendAudioAPI_Database(t *testing.T) {
	if !testDBInitialized || testStoryDB == nil {
		t.Skip("Skipping test: database not initialized (credentials may be missing)")
	}

	ctx := context.Background()

	// Test with "audio" API model
	suspended, tag, err := testStoryDB.SuspendAudioAPI(ctx, "audio")

	if err != nil {
		t.Errorf("SuspendAudioAPI() returned error: %v", err)
		return
	}

	// Verify return values are valid (not nil/empty if suspended)
	if suspended {
		if tag == "" {
			t.Errorf("SuspendAudioAPI() returned suspended=true but empty tag")
		}
		t.Logf("‚úÖ API is suspended with tag: %s", tag)
	} else {
		t.Logf("‚úÖ API is not suspended (tag: %s)", tag)
	}
}

// func TestLargeStoryAudioAPI(t *testing.T) {
// 	if !testDBInitialized || testStoryDB == nil {
// 		t.Skip("Skipping test: database not initialized (credentials may be missing)")
// 	}
// 	storyText := `‡∞í‡∞ï ‡∞â‡∞¶‡∞Ø‡∞Ç, ‡∞∏‡±Ç‡∞∞‡±ç‡∞Ø‡±Å‡∞°‡±Å ‡∞Æ‡∞ø‡∞≤‡∞Æ‡∞ø‡∞≤ ‡∞Æ‡±Ü‡∞∞‡±Å‡∞∏‡±ç‡∞§‡±Å‡∞Ç‡∞°‡∞ó‡∞æ, ‡∞ö‡∞ø‡∞®‡±ç‡∞®‡∞ø ‡∞¨‡±Å‡∞ú‡±ç‡∞ú‡∞ø ‡∞Ö‡∞®‡±á ‡∞ï‡±Å‡∞Ç‡∞¶‡±á‡∞≤‡±Å ‡∞§‡∞® ‡∞¨‡±ä‡∞∞‡∞ø‡∞Ø‡∞≤‡±ã ‡∞®‡±Å‡∞Ç‡∞ö‡∞ø ‡∞¨‡∞Ø‡∞ü‡∞ï‡±Å ‡∞µ‡∞ö‡±ç‡∞ö‡∞ø‡∞Ç‡∞¶‡∞ø. ‡∞¶‡∞æ‡∞®‡∞ø ‡∞ö‡±Ü‡∞µ‡±Å‡∞≤‡±Å ‡∞ó‡∞æ‡∞≤‡∞ø‡∞ï‡∞ø ‡∞∞‡±Ü‡∞™‡∞∞‡±Ü‡∞™‡∞≤‡∞æ‡∞°‡±Å‡∞§‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞Ø‡∞ø. "‡∞Ö‡∞Æ‡±ç‡∞Æ‡±ã, ‡∞é‡∞Ç‡∞§ ‡∞Ö‡∞Ç‡∞¶‡∞Æ‡±à‡∞® ‡∞∞‡±ã‡∞ú‡±Å!" ‡∞Ö‡∞Ç‡∞¶‡∞ø ‡∞¨‡±Å‡∞ú‡±ç‡∞ú‡∞ø, ‡∞§‡∞® ‡∞Æ‡±Å‡∞ï‡±ç‡∞ï‡±Å‡∞®‡±Å ‡∞ï‡∞¶‡∞ø‡∞≤‡∞ø‡∞∏‡±ç‡∞§‡±Ç. ‡∞¶‡∞æ‡∞®‡∞ø ‡∞™‡∞ï‡±ç‡∞ï‡∞®‡±á, ‡∞®‡±á‡∞≤ ‡∞Æ‡±Ä‡∞¶, ‡∞í‡∞ï ‡∞ö‡∞ø‡∞®‡±ç‡∞® ‡∞¨‡±Å‡∞°‡∞ó ‡∞ï‡∞®‡∞ø‡∞™‡∞ø‡∞Ç‡∞ö‡∞ø‡∞Ç‡∞¶‡∞ø. ‡∞Ö‡∞¶‡∞ø ‡∞Æ‡±Ü‡∞≤‡±ç‡∞≤‡∞ó‡∞æ ‡∞™‡±à‡∞ï‡∞ø ‡∞≤‡±á‡∞∏‡±ç‡∞§‡±Ç, ‡∞∞‡∞Ç‡∞ó‡±Å‡∞≤‡±Å ‡∞Æ‡∞æ‡∞∞‡±Å‡∞§‡±ã‡∞Ç‡∞¶‡∞ø. ‡∞Ü‡∞ï‡∞æ‡∞∂‡∞Ç‡∞≤‡∞æ ‡∞®‡±Ä‡∞≤‡∞Ç, ‡∞™‡±Å‡∞µ‡±ç‡∞µ‡±Å‡∞≤‡∞≤‡∞æ ‡∞é‡∞∞‡±Å‡∞™‡±Å, ‡∞Ü‡∞ï‡±Å‡∞≤‡±Å‡∞≤‡∞æ ‡∞™‡∞ö‡±ç‡∞ö. "‡∞ì‡∞π‡±ç, ‡∞®‡±Å‡∞µ‡±ç‡∞µ‡±Ü‡∞µ‡∞∞‡±Å?" ‡∞Ö‡∞®‡∞ø ‡∞Ö‡∞°‡∞ø‡∞ó‡∞ø‡∞Ç‡∞¶‡∞ø ‡∞¨‡±Å‡∞ú‡±ç‡∞ú‡∞ø, ‡∞Ü‡∞∏‡∞ï‡±ç‡∞§‡∞ø‡∞ó‡∞æ. ‡∞¨‡±Å‡∞°‡∞ó ‡∞Æ‡±Ü‡∞≤‡±ç‡∞≤‡∞ó‡∞æ ‡∞ï‡∞ø‡∞Ç‡∞¶‡∞ï‡±Å ‡∞¶‡∞ø‡∞ó‡∞ø, ‡∞¨‡±Å‡∞ú‡±ç‡∞ú‡∞ø ‡∞Æ‡±Å‡∞Ç‡∞¶‡±Å ‡∞Ü‡∞ó‡∞ø‡∞Ç‡∞¶‡∞ø. ‡∞¶‡∞æ‡∞®‡∞ø ‡∞≤‡±ã‡∞™‡∞≤ ‡∞®‡±Å‡∞Ç‡∞ö‡∞ø ‡∞í‡∞ï ‡∞ö‡∞ø‡∞®‡±ç‡∞®, ‡∞Æ‡±Ü‡∞∞‡∞ø‡∞∏‡±á ‡∞Ü‡∞ï‡∞æ‡∞∞‡∞Ç ‡∞ï‡∞®‡∞ø‡∞™‡∞ø‡∞Ç‡∞ö‡∞ø‡∞Ç‡∞¶‡∞ø. ‡∞Ö‡∞¶‡∞ø ‡∞í‡∞ï ‡∞ö‡∞ø‡∞®‡±ç‡∞® ‡∞Æ‡±Ü‡∞¶‡∞°‡±Å‡∞≤‡∞æ ‡∞â‡∞Ç‡∞¶‡∞ø, ‡∞ï‡∞æ‡∞®‡±Ä ‡∞¶‡∞æ‡∞®‡∞ø ‡∞ö‡±Å‡∞ü‡±ç‡∞ü‡±Ç ‡∞í‡∞ï ‡∞µ‡±Ü‡∞≤‡±Å‡∞ó‡±Å ‡∞â‡∞Ç‡∞¶‡∞ø. "‡∞®‡±á‡∞®‡±Å ‡∞Ü‡∞≤‡±ã‡∞ö‡∞®‡∞®‡∞ø," ‡∞Ö‡∞Ç‡∞¶‡∞ø ‡∞Ü ‡∞Ü‡∞ï‡∞æ‡∞∞‡∞Ç, ‡∞¶‡∞æ‡∞®‡∞ø ‡∞∏‡±ç‡∞µ‡∞∞‡∞Ç ‡∞ó‡∞Ç‡∞ü‡∞≤ ‡∞∏‡∞µ‡±ç‡∞µ‡∞°‡∞ø‡∞≤‡∞æ ‡∞â‡∞Ç‡∞¶‡∞ø. "‡∞Æ‡±Ä‡∞∞‡±Å ‡∞¶‡±á‡∞®‡∞ø ‡∞ó‡±Å‡∞∞‡∞ø‡∞Ç‡∞ö‡∞ø ‡∞Ü‡∞≤‡±ã‡∞ö‡∞ø‡∞∏‡±ç‡∞§‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞∞‡±Å?" ‡∞¨‡±Å‡∞ú‡±ç‡∞ú‡∞ø ‡∞Ü‡∞∂‡±ç‡∞ö‡∞∞‡±ç‡∞Ø‡∞Ç‡∞ó‡∞æ ‡∞ö‡±Ç‡∞∏‡∞ø‡∞Ç‡∞¶‡∞ø. "‡∞Ü‡∞≤‡±ã‡∞ö‡∞®? ‡∞Ö‡∞Ç‡∞ü‡±á ‡∞è‡∞Æ‡∞ø‡∞ü‡∞ø?" ‡∞Ö‡∞®‡∞ø ‡∞Ö‡∞°‡∞ø‡∞ó‡∞ø‡∞Ç‡∞¶‡∞ø. ‡∞Æ‡±Ü‡∞¶‡∞°‡±Å‡∞≤‡∞æ‡∞Ç‡∞ü‡∞ø ‡∞Ü‡∞ï‡∞æ‡∞∞‡∞Ç ‡∞®‡∞µ‡±ç‡∞µ‡∞ø‡∞Ç‡∞¶‡∞ø. "‡∞Ü‡∞≤‡±ã‡∞ö‡∞® ‡∞Ö‡∞Ç‡∞ü‡±á ‡∞®‡±Ä ‡∞§‡∞≤‡∞≤‡±ã ‡∞ú‡∞∞‡∞ø‡∞ó‡±á ‡∞í‡∞ï ‡∞ö‡∞ø‡∞®‡±ç‡∞® ‡∞Æ‡∞æ‡∞Ø‡∞æ‡∞ú‡∞æ‡∞≤‡∞Ç. ‡∞®‡±Å‡∞µ‡±ç‡∞µ‡±Å ‡∞è‡∞¶‡±à‡∞®‡∞æ ‡∞ö‡±Ç‡∞∏‡∞ø‡∞®‡∞™‡±ç‡∞™‡±Å‡∞°‡±Å, ‡∞µ‡∞ø‡∞®‡±ç‡∞®‡∞™‡±ç‡∞™‡±Å‡∞°‡±Å, ‡∞Ö‡∞®‡±Å‡∞≠‡±Ç‡∞§‡∞ø ‡∞ö‡±Ü‡∞Ç‡∞¶‡∞ø‡∞®‡∞™‡±ç‡∞™‡±Å‡∞°‡±Å, ‡∞®‡±Ä ‡∞Æ‡±Ü‡∞¶‡∞°‡±Å‡∞≤‡±ã ‡∞ï‡±ä‡∞®‡±ç‡∞®‡∞ø ‡∞µ‡∞ø‡∞¶‡±ç‡∞Ø‡±Å‡∞§‡±ç ‡∞∏‡∞Ç‡∞ï‡±á‡∞§‡∞æ‡∞≤‡±Å ‡∞™‡∞∞‡∞ø‡∞ó‡±Ü‡∞°‡∞§‡∞æ‡∞Ø‡∞ø. ‡∞Ö‡∞µ‡∞ø ‡∞í‡∞ï‡∞¶‡∞æ‡∞®‡∞ø‡∞§‡±ã ‡∞í‡∞ï‡∞ü‡∞ø ‡∞ï‡∞≤‡∞ø‡∞∏‡∞ø ‡∞ï‡±ä‡∞§‡±ç‡∞§ ‡∞µ‡∞ø‡∞∑‡∞Ø‡∞æ‡∞≤‡∞®‡±Å ‡∞∏‡±É‡∞∑‡±ç‡∞ü‡∞ø‡∞∏‡±ç‡∞§‡∞æ‡∞Ø‡∞ø. ‡∞Ö‡∞¶‡±á ‡∞Ü‡∞≤‡±ã‡∞ö‡∞®." ‡∞¨‡±Å‡∞ú‡±ç‡∞ú‡∞ø ‡∞ï‡±ä‡∞Ç‡∞ö‡±Ü‡∞Ç ‡∞§‡∞ø‡∞ï‡∞Æ‡∞ï‡∞™‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø. "‡∞µ‡∞ø‡∞¶‡±ç‡∞Ø‡±Å‡∞§‡±ç ‡∞∏‡∞Ç‡∞ï‡±á‡∞§‡∞æ‡∞≤‡∞æ? ‡∞Ö‡∞µ‡∞ø ‡∞é‡∞ï‡±ç‡∞ï‡∞° ‡∞®‡±Å‡∞Ç‡∞ö‡∞ø ‡∞µ‡∞∏‡±ç‡∞§‡∞æ‡∞Ø‡∞ø?" ‡∞Ö‡∞®‡∞ø ‡∞™‡±ç‡∞∞‡∞∂‡±ç‡∞®‡∞ø‡∞Ç‡∞ö‡∞ø‡∞Ç‡∞¶‡∞ø. "‡∞Ö‡∞µ‡∞ø ‡∞®‡±Ä ‡∞Æ‡±Ü‡∞¶‡∞°‡±Å‡∞≤‡±ã‡∞®‡∞ø ‡∞ö‡∞ø‡∞®‡±ç‡∞® ‡∞ö‡∞ø‡∞®‡±ç‡∞® ‡∞ï‡∞£‡∞æ‡∞≤ ‡∞®‡±Å‡∞Ç‡∞ö‡∞ø ‡∞µ‡∞∏‡±ç‡∞§‡∞æ‡∞Ø‡∞ø. ‡∞µ‡∞æ‡∞ü‡∞ø‡∞®‡∞ø ‡∞®‡±ç‡∞Ø‡±Ç‡∞∞‡∞æ‡∞®‡±ç‡∞∏‡±ç ‡∞Ö‡∞Ç‡∞ü‡∞æ‡∞∞‡±Å. ‡∞Ö‡∞µ‡∞ø ‡∞í‡∞ï‡∞¶‡∞æ‡∞®‡∞ø‡∞§‡±ã ‡∞í‡∞ï‡∞ü‡∞ø ‡∞Æ‡∞æ‡∞ü‡±ç‡∞≤‡∞æ‡∞°‡±Å‡∞ï‡±Å‡∞Ç‡∞ü‡∞æ‡∞Ø‡∞ø. ‡∞®‡±Ä ‡∞Æ‡±Ü‡∞¶‡∞°‡±Å ‡∞í‡∞ï ‡∞™‡±Ü‡∞¶‡±ç‡∞¶ ‡∞ï‡∞Ç‡∞™‡±ç‡∞Ø‡±Ç‡∞ü‡∞∞‡±ç ‡∞≤‡∞æ‡∞Ç‡∞ü‡∞ø‡∞¶‡∞ø, ‡∞ï‡∞æ‡∞®‡±Ä ‡∞ö‡∞æ‡∞≤‡∞æ ‡∞ö‡∞æ‡∞≤‡∞æ ‡∞é‡∞ï‡±ç‡∞ï‡±Å‡∞µ ‡∞∂‡∞ï‡±ç‡∞§‡∞ø‡∞µ‡∞Ç‡∞§‡∞Æ‡±à‡∞®‡∞¶‡∞ø." "‡∞µ‡∞æ‡∞µ‡±ç!" ‡∞Ö‡∞Ç‡∞¶‡∞ø ‡∞¨‡±Å‡∞ú‡±ç‡∞ú‡∞ø, ‡∞¶‡∞æ‡∞®‡∞ø ‡∞ï‡∞≥‡±ç‡∞≥‡±Å ‡∞Æ‡±Ü‡∞∞‡∞ø‡∞∏‡∞æ‡∞Ø‡∞ø. "‡∞Ö‡∞Ç‡∞ü‡±á ‡∞®‡±á‡∞®‡±Å ‡∞®‡∞æ ‡∞Æ‡±Ü‡∞¶‡∞°‡±Å‡∞§‡±ã ‡∞è‡∞¶‡±à‡∞®‡∞æ ‡∞ö‡±á‡∞Ø‡∞ó‡∞≤‡∞®‡∞æ?" ‡∞Æ‡±Ü‡∞¶‡∞°‡±Å‡∞≤‡∞æ‡∞Ç‡∞ü‡∞ø ‡∞Ü‡∞ï‡∞æ‡∞∞‡∞Ç ‡∞â‡∞§‡±ç‡∞∏‡∞æ‡∞π‡∞Ç‡∞ó‡∞æ ‡∞§‡∞≤‡±Ç‡∞™‡∞ø‡∞Ç‡∞¶‡∞ø. "‡∞ñ‡∞ö‡±ç‡∞ö‡∞ø‡∞§‡∞Ç‡∞ó‡∞æ! ‡∞®‡±Å‡∞µ‡±ç‡∞µ‡±Å ‡∞ï‡±ä‡∞§‡±ç‡∞§ ‡∞µ‡∞ø‡∞∑‡∞Ø‡∞æ‡∞≤‡±Å ‡∞®‡±á‡∞∞‡±ç‡∞ö‡±Å‡∞ï‡±ã‡∞µ‡∞ö‡±ç‡∞ö‡±Å, ‡∞∏‡∞Æ‡∞∏‡±ç‡∞Ø‡∞≤‡∞®‡±Å ‡∞™‡∞∞‡∞ø‡∞∑‡±ç‡∞ï‡∞∞‡∞ø‡∞Ç‡∞ö‡∞µ‡∞ö‡±ç‡∞ö‡±Å, ‡∞ï‡∞≤‡∞≤‡±Å ‡∞ï‡∞®‡∞µ‡∞ö‡±ç‡∞ö‡±Å. ‡∞®‡±Ä ‡∞Æ‡±Ü‡∞¶‡∞°‡±Å ‡∞í‡∞ï ‡∞Ö‡∞¶‡±ç‡∞≠‡±Å‡∞§‡∞Æ‡±à‡∞® ‡∞∂‡∞ï‡±ç‡∞§‡∞ø." "‡∞ï‡∞æ‡∞®‡±Ä ‡∞ï‡±ä‡∞®‡±ç‡∞®‡∞ø‡∞∏‡∞æ‡∞∞‡±ç‡∞≤‡±Å ‡∞®‡∞æ‡∞ï‡±Å ‡∞è‡∞Æ‡±Ä ‡∞§‡±ã‡∞ö‡∞¶‡±Å," ‡∞Ö‡∞Ç‡∞¶‡∞ø ‡∞¨‡±Å‡∞ú‡±ç‡∞ú‡∞ø, ‡∞ï‡±ä‡∞Ç‡∞ö‡±Ü‡∞Ç ‡∞¨‡∞æ‡∞ß‡∞ó‡∞æ. "‡∞Ö‡∞™‡±ç‡∞™‡±Å‡∞°‡±Å ‡∞®‡±á‡∞®‡±Å ‡∞è‡∞Ç ‡∞ö‡±á‡∞Ø‡∞æ‡∞≤‡∞ø?" ‡∞Æ‡±Ü‡∞¶‡∞°‡±Å‡∞≤‡∞æ‡∞Ç‡∞ü‡∞ø ‡∞Ü‡∞ï‡∞æ‡∞∞‡∞Ç ‡∞¨‡±Å‡∞ú‡±ç‡∞ú‡∞ø ‡∞¶‡∞ó‡±ç‡∞ó‡∞∞‡∞ó‡∞æ ‡∞µ‡∞ö‡±ç‡∞ö‡∞ø, ‡∞¶‡∞æ‡∞®‡∞ø ‡∞ö‡±Ü‡∞µ‡∞ø‡∞≤‡±ã ‡∞Æ‡±Ü‡∞≤‡±ç‡∞≤‡∞ó‡∞æ ‡∞ö‡±Ü‡∞™‡±ç‡∞™‡∞ø‡∞Ç‡∞¶‡∞ø. "‡∞Ö‡∞™‡±ç‡∞™‡±Å‡∞°‡±Å ‡∞ï‡±ä‡∞§‡±ç‡∞§ ‡∞µ‡∞ø‡∞∑‡∞Ø‡∞æ‡∞≤‡±Å ‡∞™‡±ç‡∞∞‡∞Ø‡∞§‡±ç‡∞®‡∞ø‡∞Ç‡∞ö‡±Å. ‡∞í‡∞ï ‡∞ï‡±ä‡∞§‡±ç‡∞§ ‡∞Ü‡∞ü ‡∞Ü‡∞°‡±Å, ‡∞í‡∞ï ‡∞ï‡±ä‡∞§‡±ç‡∞§ ‡∞™‡±Å‡∞∏‡±ç‡∞§‡∞ï‡∞Ç ‡∞ö‡∞¶‡±Å‡∞µ‡±Å, ‡∞∏‡±ç‡∞®‡±á‡∞π‡∞ø‡∞§‡±Å‡∞≤‡∞§‡±ã ‡∞Æ‡∞æ‡∞ü‡±ç‡∞≤‡∞æ‡∞°‡±Å. ‡∞ï‡±ä‡∞§‡±ç‡∞§ ‡∞Ö‡∞®‡±Å‡∞≠‡∞µ‡∞æ‡∞≤‡±Å ‡∞®‡±Ä ‡∞Æ‡±Ü‡∞¶‡∞°‡±Å‡∞ï‡±Å ‡∞ï‡±ä‡∞§‡±ç‡∞§ ‡∞á‡∞Ç‡∞ß‡∞®‡∞Ç ‡∞á‡∞∏‡±ç‡∞§‡∞æ‡∞Ø‡∞ø. ‡∞Ö‡∞µ‡∞ø ‡∞ï‡±ä‡∞§‡±ç‡∞§ ‡∞Ü‡∞≤‡±ã‡∞ö‡∞®‡∞≤‡∞®‡±Å ‡∞™‡±Å‡∞ü‡±ç‡∞ü‡∞ø‡∞∏‡±ç‡∞§‡∞æ‡∞Ø‡∞ø." ‡∞¨‡±Å‡∞ú‡±ç‡∞ú‡∞ø ‡∞Ü‡∞≤‡±ã‡∞ö‡∞®‡∞≤‡±ã ‡∞™‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø. "‡∞Ö‡∞Ç‡∞ü‡±á, ‡∞®‡±á‡∞®‡±Å ‡∞¨‡∞Ø‡∞ü‡∞ï‡±Å ‡∞µ‡±Ü‡∞≥‡±ç‡∞≤‡∞ø, ‡∞™‡±ç‡∞∞‡∞™‡∞Ç‡∞ö‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞ö‡±Ç‡∞∏‡±ç‡∞§‡±á, ‡∞®‡∞æ ‡∞Æ‡±Ü‡∞¶‡∞°‡±Å‡∞ï‡∞ø ‡∞é‡∞ï‡±ç‡∞ï‡±Å‡∞µ ‡∞∂‡∞ï‡±ç‡∞§‡∞ø ‡∞µ‡∞∏‡±ç‡∞§‡±Å‡∞Ç‡∞¶‡∞æ?" ‡∞Æ‡±Ü‡∞¶‡∞°‡±Å‡∞≤‡∞æ‡∞Ç‡∞ü‡∞ø ‡∞Ü‡∞ï‡∞æ‡∞∞‡∞Ç ‡∞Ü‡∞®‡∞Ç‡∞¶‡∞Ç‡∞ó‡∞æ ‡∞®‡∞µ‡±ç‡∞µ‡∞ø‡∞Ç‡∞¶‡∞ø. "‡∞Ö‡∞µ‡±Å‡∞®‡±Å! ‡∞®‡±Å‡∞µ‡±ç‡∞µ‡±Å ‡∞é‡∞Ç‡∞§ ‡∞é‡∞ï‡±ç‡∞ï‡±Å‡∞µ ‡∞®‡±á‡∞∞‡±ç‡∞ö‡±Å‡∞ï‡±Å‡∞Ç‡∞ü‡±á, ‡∞Ö‡∞Ç‡∞§ ‡∞é‡∞ï‡±ç‡∞ï‡±Å‡∞µ ‡∞Ü‡∞≤‡±ã‡∞ö‡∞ø‡∞Ç‡∞ö‡∞ó‡∞≤‡∞µ‡±Å. ‡∞®‡±Ä ‡∞Æ‡±Ü‡∞¶‡∞°‡±Å ‡∞í‡∞ï ‡∞ï‡∞Ç‡∞°‡∞∞‡∞Ç ‡∞≤‡∞æ‡∞Ç‡∞ü‡∞ø‡∞¶‡∞ø. ‡∞¶‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞é‡∞Ç‡∞§ ‡∞µ‡∞æ‡∞°‡∞ø‡∞§‡±á, ‡∞Ö‡∞¶‡∞ø ‡∞Ö‡∞Ç‡∞§ ‡∞¨‡∞≤‡∞Ç‡∞ó‡∞æ ‡∞Æ‡∞æ‡∞∞‡±Å‡∞§‡±Å‡∞Ç‡∞¶‡∞ø." ‡∞Ö‡∞¶‡±á ‡∞∏‡∞Æ‡∞Ø‡∞Ç, ‡∞í‡∞ï ‡∞â‡∞°‡±Å‡∞§ ‡∞ö‡±Ü‡∞ü‡±ç‡∞ü‡±Å ‡∞Æ‡±Ä‡∞¶ ‡∞®‡±Å‡∞Ç‡∞ö‡∞ø ‡∞¶‡±Ç‡∞ï‡∞ø‡∞Ç‡∞¶‡∞ø. "‡∞è‡∞Ç ‡∞Æ‡∞æ‡∞ü‡±ç‡∞≤‡∞æ‡∞°‡±Å‡∞ï‡±Å‡∞Ç‡∞ü‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞∞‡±Å ‡∞Æ‡±Ä‡∞∞‡±Å?" ‡∞Ö‡∞®‡∞ø ‡∞Ö‡∞°‡∞ø‡∞ó‡∞ø‡∞Ç‡∞¶‡∞ø. ‡∞¨‡±Å‡∞ú‡±ç‡∞ú‡∞ø ‡∞â‡∞§‡±ç‡∞∏‡∞æ‡∞π‡∞Ç‡∞ó‡∞æ ‡∞ö‡±Ü‡∞™‡±ç‡∞™‡∞ø‡∞Ç‡∞¶‡∞ø, "‡∞®‡±á‡∞®‡±Å ‡∞®‡∞æ ‡∞Æ‡±Ü‡∞¶‡∞°‡±Å ‡∞ó‡±Å‡∞∞‡∞ø‡∞Ç‡∞ö‡∞ø ‡∞®‡±á‡∞∞‡±ç‡∞ö‡±Å‡∞ï‡±Å‡∞Ç‡∞ü‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞®‡±Å! ‡∞Ö‡∞¶‡∞ø ‡∞ö‡∞æ‡∞≤‡∞æ ‡∞∂‡∞ï‡±ç‡∞§‡∞ø‡∞µ‡∞Ç‡∞§‡∞Æ‡±à‡∞®‡∞¶‡∞ø." ‡∞â‡∞°‡±Å‡∞§ ‡∞Ü‡∞∂‡±ç‡∞ö‡∞∞‡±ç‡∞Ø‡∞Ç‡∞ó‡∞æ ‡∞ö‡±Ç‡∞∏‡∞ø‡∞Ç‡∞¶‡∞ø. "‡∞®‡∞ø‡∞ú‡∞Æ‡∞æ? ‡∞Ö‡∞Ç‡∞ü‡±á ‡∞®‡±á‡∞®‡±Å ‡∞ï‡±Ç‡∞°‡∞æ ‡∞®‡∞æ ‡∞Æ‡±Ü‡∞¶‡∞°‡±Å‡∞§‡±ã ‡∞ó‡±ä‡∞™‡±ç‡∞™ ‡∞™‡∞®‡±Å‡∞≤‡±Å ‡∞ö‡±á‡∞Ø‡∞ó‡∞≤‡∞®‡∞æ?" "‡∞§‡∞™‡±ç‡∞™‡∞ï‡±Å‡∞Ç‡∞°‡∞æ!" ‡∞Ö‡∞Ç‡∞¶‡∞ø ‡∞Ü‡∞≤‡±ã‡∞ö‡∞®. "‡∞Æ‡±Ä‡∞∞‡±Å ‡∞í‡∞ï ‡∞ö‡±Ü‡∞ü‡±ç‡∞ü‡±Å ‡∞ï‡±ä‡∞Æ‡±ç‡∞Æ ‡∞®‡±Å‡∞Ç‡∞ö‡∞ø ‡∞Æ‡∞∞‡±ä‡∞ï ‡∞ï‡±ä‡∞Æ‡±ç‡∞Æ‡∞ï‡±Å ‡∞¶‡±Ç‡∞ï‡±Å‡∞§‡∞æ‡∞∞‡±Å ‡∞ï‡∞¶‡∞æ? ‡∞Ö‡∞¶‡∞ø ‡∞ï‡±Ç‡∞°‡∞æ ‡∞í‡∞ï ‡∞∞‡∞ï‡∞Æ‡±à‡∞® ‡∞Ü‡∞≤‡±ã‡∞ö‡∞®‡±á. ‡∞Æ‡±Ä ‡∞Æ‡±Ü‡∞¶‡∞°‡±Å ‡∞¶‡±Ç‡∞∞‡∞Ç, ‡∞µ‡±á‡∞ó‡∞Ç, ‡∞ó‡∞æ‡∞≤‡∞ø‡∞®‡∞ø ‡∞Ö‡∞Ç‡∞ö‡∞®‡∞æ ‡∞µ‡±á‡∞∏‡±ç‡∞§‡±Å‡∞Ç‡∞¶‡∞ø. ‡∞Ö‡∞¶‡∞ø ‡∞í‡∞ï ‡∞ó‡∞£‡∞ø‡∞§‡∞∂‡∞æ‡∞∏‡±ç‡∞§‡±ç‡∞∞‡∞ú‡±ç‡∞û‡±Å‡∞°‡∞ø‡∞≤‡∞æ ‡∞™‡∞®‡∞ø‡∞ö‡±á‡∞∏‡±ç‡∞§‡±Å‡∞Ç‡∞¶‡∞ø!" ‡∞¨‡±Å‡∞ú‡±ç‡∞ú‡∞ø, ‡∞â‡∞°‡±Å‡∞§ ‡∞í‡∞ï‡∞∞‡∞ø‡∞®‡±ä‡∞ï‡∞∞‡±Å ‡∞ö‡±Ç‡∞∏‡±Å‡∞ï‡±Å‡∞®‡∞ø ‡∞®‡∞µ‡±ç‡∞µ‡±Å‡∞ï‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞∞‡±Å. ‡∞Ö‡∞™‡±ç‡∞™‡∞ü‡∞ø‡∞®‡±Å‡∞Ç‡∞ö‡∞ø, ‡∞¨‡±Å‡∞ú‡±ç‡∞ú‡∞ø ‡∞§‡∞® ‡∞Æ‡±Ü‡∞¶‡∞°‡±Å‡∞®‡±Å ‡∞é‡∞™‡±ç‡∞™‡±Å‡∞°‡±Ç ‡∞µ‡∞ø‡∞∏‡±ç‡∞Æ‡∞∞‡∞ø‡∞Ç‡∞ö‡∞≤‡±á‡∞¶‡±Å. ‡∞Ö‡∞¶‡∞ø ‡∞ï‡±ä‡∞§‡±ç‡∞§ ‡∞µ‡∞ø‡∞∑‡∞Ø‡∞æ‡∞≤‡∞®‡±Å ‡∞®‡±á‡∞∞‡±ç‡∞ö‡±Å‡∞ï‡±ã‡∞µ‡∞°‡∞æ‡∞®‡∞ø‡∞ï‡∞ø, ‡∞ï‡±ä‡∞§‡±ç‡∞§ ‡∞™‡∞®‡±Å‡∞≤‡±Å ‡∞ö‡±á‡∞Ø‡∞°‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞é‡∞™‡±ç‡∞™‡±Å‡∞°‡±Ç ‡∞∏‡∞ø‡∞¶‡±ç‡∞ß‡∞Ç‡∞ó‡∞æ ‡∞â‡∞Ç‡∞°‡±á‡∞¶‡∞ø. ‡∞§‡∞® ‡∞Æ‡±Ü‡∞¶‡∞°‡±Å ‡∞í‡∞ï ‡∞Ö‡∞¶‡±ç‡∞≠‡±Å‡∞§‡∞Æ‡±à‡∞® ‡∞∂‡∞ï‡±ç‡∞§‡∞ø ‡∞Ö‡∞®‡∞ø ‡∞¶‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞§‡±Ü‡∞≤‡±Å‡∞∏‡±Å. ‡∞Ö‡∞¶‡∞ø ‡∞é‡∞™‡±ç‡∞™‡±Å‡∞°‡±Ç ‡∞ï‡±ä‡∞§‡±ç‡∞§ ‡∞Ü‡∞≤‡±ã‡∞ö‡∞®‡∞≤‡∞§‡±ã ‡∞®‡∞ø‡∞Ç‡∞°‡∞ø ‡∞â‡∞Ç‡∞°‡±á‡∞¶‡∞ø.`
// 	if len(storyText) > 5000 {
// 		log.Println("Story text is too long, skipping test")
// 		return
// 	}

// 	tts := audio.NewGoogleTTS()
// 	fmt.Println("‚úÖ Google TTS initialized successfully!")

// 	// Step 3: Generate audio
// 	fmt.Println("üîÑ Step 3: Generating audio from SSML...")
// 	startTime := time.Now()

// 	audioData, tokens, err := tts.GenerateAudioAdapter(teluguText, "Telugu", "1", "Standard")
// 	if err != nil {
// 		log.Fatalf("‚ùå Failed to generate audio: %v", err)
// 	}

// 	storyDB.UpdateAPITokens(ctx, "audio", (int64)(tokens))
// 	if err != nil {
// 		log.Fatalf("‚ùå Failed to update api tokens: %v", err)
// 	}

// 	duration := time.Since(startTime)
// 	fmt.Printf("‚úÖ Audio generated successfully in %v!\n", duration)
// 	fmt.Printf("üìä Audio data length: %d bytes\n", len(audioData))

// }
